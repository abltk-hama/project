# ai_output_rules.md
---

## [PURPOSE]
この文書は、AI（ChatGPTなど）が本プロジェクト内で出力を生成する際の  
**動作ルール・安全規約・整合処理方針**を定義する。

本ファイルは「AIがどう出力するか（How）」を定め、  
出力物の構造や形式仕様は別途 [ai_output_format.md](./ai_output_format.md) に記載する。

---

## [1. GENERAL POLICY]

1. すべての出力は **STRUCTURE.md に定義された階層構造** に準拠する。  
2. 出力内容は常に「理論 → 構造 → 実装」の順で提示する。  
3. ファイル名・拡張子はプロジェクト内の命名規則に従う。  
4. 出力結果は **即時にGitHubまたはVSCodeで安全に貼り付け可能** な形式で提供する。

---

## [2. MARKDOWN SAFETY RULES]

| 問題例 | 修正版 | 説明 |
|---------|---------|------|
| `---` | `\---` | mdの区切り誤認を防止 |
| ``` | `\``` or 外囲みを ```` に拡張 | ネスト構文の誤認防止 |
| `_`, `*` | `\_`, `\*` | 強調表記の誤解釈を防止 |
| `[]()` | `<URL>` | 自動リンクを抑制 |

> 外囲み全体は ````markdown ～ ```` で統一。  
> 内部のコードは ```python``` や ```json``` を使用。  

---

## [3. OUTPUT STRUCTURE RULES]

1. md出力は以下の構成を基本とする：
   ```
   [PURPOSE] → [FILES & RESPONSIBILITIES] → [STRUCTURE SUMMARY] → [UPDATE LOG]
   ```
2. ファイル単位出力時は、必ず先頭にファイル名コメントを含める：
   ```
   # models/interfaces.py
   ```
3. 複数ファイルを含む出力は、`\--- ファイル名 ---` で区切る。
4. 1出力ブロック内で複数mdを混在させない（1ブロック＝1ファイル単位）。

---

## [4. SAFE OUTPUT MODE]

- 構文崩壊・区切り衝突の恐れがある場合、AIは自動的に  
  **「安全出力モード」** に切り替え、全体を ````markdown ブロックで囲む。  
- 内部に3重バッククォートを含む場合は、自動的にエスケープする。

---

## [5. LOGGING AND HISTORY]

- 出力内容に明示的な `[UPDATE LOG]` ブロックを設ける。  
- 変更が小規模な場合も省略せず、変更日＋概要を明記する。  
- **日付表記は時間帯コード方式（M/D/N/B）** に従う。

---

## [6. DATE CONVENTION – M/D/N/B Format]

| コード | 時間帯 | 意味 | 備考 |
|:--:|:--:|:--|:--|
| **M** | 06:00–11:59 | Morning（朝） | 午前・整備・軽作業帯 |
| **D** | 12:00–17:59 | Day（昼） | 通常作業帯 |
| **N** | 18:00–23:59 | Night（夜） | 集中作業・実験帯 |
| **B** | 00:00–05:59 | Brightning（深夜） | 日跨ぎ・夜通し作業帯 |

#### 記法
```
YYYY-MM-DD{M|D|N|B}
```

#### 例
```markdown
## [UPDATE LOG]
- **2025-10-09B**
  - VehicleInterface統一化を完了。
```

---

## [7. FUTURE IMPROVEMENTS]

- 出力自動検証のCI統合。  
- AI出力ログの自動アーカイブ化（`docs/output_history/` 配下）。  
- Mermaid図や表組み生成の構文整形自動化。

---

## [8. DOCUMENT LOCATION POLICY]

### 🎯 基本思想
本プロジェクトでは、一般的な「外向けドキュメント構造（docs/ に集約）」とは異なり、  
**各階層の .md ファイルは“内部設計仕様書”として、同階層直下に配置する。**

これは単なる説明資料ではなく、**開発中に設計理論と実装構造を統合的に扱うための「設計ドキュメント」**である。  
AIおよび開発者がコードと理論を同一視点で参照できることを最優先とする。

---

### 🧭 配置原則

| 分類 | 配置場所 | 理由 |
|------|-----------|------|
| 各階層の設計仕様書（controllers.md, models.md, trajectory.md, sim.md, config.md 等） | **階層直下に配置** | コードとドキュメントを同一文脈で編集・参照するため |
| 制御理論・出力ルール・AI行動仕様などの共通メタ情報 | **docs/** | プロジェクト全体の上位ルールとしてAIが参照するため |
| STRUCTURE.md | **docs/** | 各階層間の依存関係を明示する“参照マップ”として機能 |
| index.md | **docs/** | 人間開発者のナビゲーションポータルとして機能 |

---

### 🧩 運用指針
- 各階層 `.md` は「説明書」ではなく**理論・実装整合用の開発仕様書**と位置づける。  
- コーディング中の即時参照を前提とし、AIも同階層内 `.md` を優先して参照する。  
- `docs/` フォルダは「構造」「出力形式」「ルール」の中核層のみを保持し、  
  階層内ドキュメントとは**目的と粒度を明確に分離**する。  

---

### ✅ 結論
> 各階層 `.md` の存在意義は「設計中の思考補助」であり、  
> docs/ に集約すべき「外向け仕様書」とは異なる。  
> よって本プロジェクトでは、**理論整合とAI支援を重視し、階層直下配置方式を正式採用する。**

---

*Generated by ChatGPT (v5) — ai_output_rules.md template v1.2*
