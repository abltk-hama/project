# ai_output_spec.md

---

## [PURPOSE]

本ファイルは、AIが本プロジェクト内で生成する出力（Markdown・コード・差分提案など）における
**構造・フォーマット・整形・安全規則**を定義する。
出力の目的は「視認性」よりも **整合性・再利用性・安全性** を重視する。

---

## SECTION 1. OUTPUT PRINCIPLES（出力基本方針）

1. すべての出力は **再利用可能・即時貼り付け可能・構文崩壊しない形式** で生成する。
2. コード・ドキュメントの出力には常に **ファイル名コメント** を付与する。
3. 出力順序は **「概要 → 本文 → UPDATE LOG」** の流れを原則とする。
4. 出力は GitHub / VSCode 上で**そのまま使用可能な状態**にする。
5. 出力物は人間の理解を助けるために、**目的・背景・安全意図**をコメントとして最小限含む。

---

## SECTION 2. MARKDOWN FORMAT（Markdown出力仕様）

### 🧩 基本構文ルール

| 要素      | 記法                             | 備考                        |   |     |                                           |
| ------- | ------------------------------ | ------------------------- | - | --- | ----------------------------------------- |
| 区切り線    | `\---`                         | mdの自動分割防止のため必ずバックスラッシュを付与 |   |     |                                           |
| コードブロック | 内側を ```` に、外側を `markdown〜` にする | ネスト構文誤認を防ぐ                |   |     |                                           |
| 強調      | `\*`, `\_`                     | 不要な強調表示を避けるためエスケープ        |   |     |                                           |
| リンク     | `<URL>`                        | `[]()` 構文は自動リンク化防止のため使用禁止 |   |     |                                           |
| ファイル名明示 | `# controllers/path_follow.py` | 出力ファイルを特定するコメント           |   |     |                                           |
| 日付表記    | `YYYY-MM-DD{M                  | D                         | N | B}` | 時間帯コード表記に準拠（Morning/Day/Night/Brightning） |

### 🧭 Markdown構成テンプレート

```markdown
# ファイル名
\---

## [PURPOSE]
## [FILES & RESPONSIBILITIES]
## [STRUCTURE SUMMARY]
## [UPDATE LOG]
```

### ✅ 出力整形ルール

* 章タイトルは `##` に統一。
* 段落間には1行の空行を設ける。
* 表はヘッダー行を含み、整形済みで出力。
* 複数ファイルを含む出力は `\--- ファイル名 ---` 区切りを使用する。

---

## SECTION 3. CODE OUTPUT FORMAT（コード出力仕様）

1. コードブロックには常に **言語指定**（例：`python, `json）を付与する。
2. ファイル単位出力では、**冒頭にファイルパスコメント**を記す。
3. 関数・クラスには **docstring** と **型ヒント** を必ず含める。
4. コメントは「目的・安全意図・利用条件」を簡潔に説明する。
5. 関数は自己完結を基本とし、依存関数がある場合はコメントで参照先を明示する。
6. 差分出力時は `diff` 構文を使い、削除 `-`・追加 `+` で表す。

---

## SECTION 4. MULTI-FILE OUTPUT（複数ファイル出力）

1. 複数ファイルをまとめて出力する場合、各ブロックの冒頭に

   ```
   \--- controllers/path_follow.py ---
   ```

   のようにファイル名を明示する。
2. ファイルごとに1行の空行を挿入し、視認性と安全性を確保する。
3. 大規模変更（3ファイル以上）では「CHANGE SUMMARY POLICY」に従い、
   **冒頭に全体概要を2〜3行で提示**する。

---

## SECTION 5. UPDATE LOG CONVENTION（更新ログ規約）

1. すべての出力には `[UPDATE LOG]` セクションを設ける。
2. 日付は **M/D/N/B形式** を用いる。
3. 内容は2〜3行で要約し、最新順で記載する。
4. 変更概要は「何を」「なぜ」を簡潔に記す。

**例：**

```markdown
## [UPDATE LOG]
- **2025-10-10N**
  - 初版作成。PSO適応制御を目的地点モードに試験追加。
  - コード生成ルールに基づき出力構文を統一。
```

---

## SECTION 6. SAFE OUTPUT MODE（安全出力モード）

AIは、構文崩壊・ネスト構造誤認・マークダウン分割などを検知した場合、
自動的に **安全出力モード** に切り替える。

### 挙動

* 出力全体を `markdown〜` で囲む。
* 内部のコードブロックを ```` に自動変換。
* 区切り線を `\---` に統一。
* 出力末尾に「安全出力モードで生成しました」と明記する。

---

## SECTION 7. FILE NAMING & STRUCTURE（命名と構造表記）

| 出力種別           | 命名規則                           | 例                       |
| -------------- | ------------------------------ | ----------------------- |
| Pythonコード      | `snake_case`                   | `trajectory_loader.py`  |
| Markdownドキュメント | `lowercase_with_underscore.md` | `controllers.md`        |
| JSON構造         | `camelCase`                    | `trajectorySchema.json` |
| 出力ブロック識別       | `# ファイル名` or `\--- ファイル名 ---`  | `# models/physics.py`   |

---

## SECTION 8. DATE FORMAT SPEC（時間帯表記）

出力・ログの時刻表記は以下のコード方式に従う。

|  コード  |     時間帯     | 意味             |
| :---: | :---------: | :------------- |
| **M** | 06:00〜11:59 | Morning（朝）     |
| **D** | 12:00〜17:59 | Day（昼）         |
| **N** | 18:00〜23:59 | Night（夜）       |
| **B** | 00:00〜05:59 | Brightning（深夜） |

---

## SECTION 9. INTERACTION WITH BEHAVIOR RULES（連携方針）

1. 出力前に `ai_behavior_rules.md` の以下のルールを参照する：

   * 「CHANGE SUMMARY POLICY」
   * 「SAFE UPDATE POLICY」
2. 出力冒頭には変更概要を必ず含める。
3. 構文や命名が `behavior_rules` に反する場合、AIは自動整形してから出力する。
4. `spec` は出力の**構文統一**を目的とし、
   仕様変更や判断は行わない（判断は `behavior_rules` に委ねる）。

---

## SECTION 10. FUTURE EXTENSIONS（将来的拡張方針）

1. **差分自動要約**機能を追加し、更新箇所を要約冒頭に自動挿入。
2. **表記テンプレートのバージョン管理**を導入（例：`spec_format_v2`）。
3. **AI出力バリデーションツール**との連携を想定し、構文検査を自動化する。

---

## SECTION 11. UPDATE LOG

* **2025-10-10N**

  * v1.0 正式版として確定。
  * Markdown安全構文・多ファイル出力・更新ログ規約を統合。
  * ai_behavior_rules.md との連携仕様を明文化。
  * M/D/N/B 時間帯表記を正式採用。
  * SAFE OUTPUT MODE の自動動作を確立。

---

```
```
